# MONEY TRANSFER
change_money_transfer_amount = {
	scope = country
	saved_scopes = {
		up
		amount
	}
	effect = {
		if = {
			limit = {
				scope:up = 1
			}
			change_variable = {
				name = imperia_money_transfer_amount
				add = scope:amount
			}
		}
		else = {
			change_variable = {
				name = imperia_money_transfer_amount
				subtract = scope:amount
			}
		}
	}
}

can_press_money_transfer_down_button = {
	scope = country
	saved_scopes = {
		up
		amount
	}
	is_valid = {
		trigger_if = {
			limit = {
				scope:amount = 10000000
				scope:up = 0
			}
			var:imperia_money_transfer_amount >= 10000000
		}
		trigger_if = {
			limit = {
				scope:amount = 1000000
				scope:up = 0
			}
			var:imperia_money_transfer_amount >= 1000000
		}
		trigger_if = {
			limit = {
				scope:amount = 100000
				scope:up = 0
			}
			var:imperia_money_transfer_amount >= 100000
		}
		trigger_if = {
			limit = {
				scope:amount = 10000
				scope:up = 0
			}
			var:imperia_money_transfer_amount >= 10000
		}
		trigger_if = {
			limit = {
				scope:amount = 1000
				scope:up = 0
			}
			var:imperia_money_transfer_amount >= 1000
		}
	}
}

set_strategic_region_transfer_money_target = {
	scope = country
	saved_scopes = {
		strategic_region
	}
	effect = {
		clear_variable_list ?= countries_in_selected_strategic_region_money_transfer
		scope:strategic_region = {
			every_scope_state = {
				limit = {
					NOT = {
						owner = root
					}
					NOT = {
						owner = {
							is_country_type = decentralized
						}
					}
				}
				owner = {
					root = {
						add_to_variable_list = {
							name = countries_in_selected_strategic_region_money_transfer
							target = prev
						}
					}
				}
			}
		}
	}
}

any_valid_money_transfer_country_in_strategic_region = {
	scope = country
	saved_scopes = {
		strategic_region
	}
	is_valid = {
		scope:strategic_region = {
			any_scope_state = {
				count > 0
				NOT = {
					owner = root
				}
				NOT = {
					owner = {
						is_country_type = decentralized
					}
				}
			}
		}
	}
}

clear_strategic_region_transfer_money_target = {
	scope = country
	effect = {
		clear_variable_list ?= countries_in_selected_strategic_region_money_transfer
	}
}

set_money_transfer_target_country = {
	scope = country
	saved_scopes = {
		target
	}
	effect = {
		set_variable = {
			name = money_transfer_target_country
			value = scope:target
		}
	}
}

target_can_receive_money = {
	scope = country
	saved_scopes = {
		target
	}
	is_valid = {
		exists = scope:target
		scope:target.imperia_current_max_of_receivable_money_value > var:imperia_money_transfer_amount
	}
}

send_money_to_target = {
	scope = country
	confirm_title = "MONEY_TRANSFER_REALLY_SEND_MONEY"
	confirm_text = "CAN_SEND_MONEY_EXPLANATION_DESC"
	saved_scopes = {
		target
	}
	is_valid = {
		custom_tooltip = {
			text = CANT_SEND_MONEY_MUST_SEND_MONEY
			var:imperia_money_transfer_amount >= 1000
		}
		custom_tooltip = {
			text = CANT_SEND_MONEY_TOO_LITTLE_CASH_ON_HAND
			var:imperia_money_transfer_amount < imperia_current_transferable_money_value
		}
		custom_tooltip = {
			text = CANT_SEND_MONEY_TOO_LITTLE_SPACE_IN_TARGET
			exists = scope:target
			scope:target.imperia_current_max_of_receivable_money_value > var:imperia_money_transfer_amount
		}
	}
	effect = {
		set_variable = {
			name = money_transfer_target_country
			value = scope:target
		}
		if = {
			limit = {
				can_send_money_to_recipient_trigger = yes
			}
			add_treasury = {
				value = var:imperia_money_transfer_amount
				multiply = -1
			}
			save_scope_as = money_sender
			save_scope_value_as = {
				name = money_amount
				value = var:imperia_money_transfer_amount
			}
			post_notification = imperia_sent_money
			scope:target = {
				add_treasury = root.var:imperia_money_transfer_amount
				post_notification = imperia_received_money
			}
		}
	}
}