on_imperia_monthly_pulse_country = {
	effect = {
		# Random events while congress is in session
		if = {
			limit = {
				has_global_variable = imperia_vienna_congress_in_session
			}
			random = {
				chance = imperia_vienna_congress_monthly_chance_for_random_event
				congress_random_events = yes
			}
		}
	}
}

#scope = country
on_imperia_monthly_pulse_store_infamy = {
	effect = {
		if = {
			limit = {
				# This should only pop for a singular country each month. Most likely a united China
				has_global_highest_gdp = yes
			}
			imperia_vienna_congress_compile_lists = yes
		}
	}
}

on_imperia_monthly_pulse_ai_congress_voting = {
	effect = {
		if = {
			limit = {
				is_player = no
				has_variable = voting_conference_member
			}
			if = {
				# Else if its a target and they're NOT opposing
				limit = {
					is_congress_target = yes
					NOT = {
						is_target_in_global_variable_list = {
							name = current_congress_members_on_stance_3
							target = this
						}
					}
				}
				# Set to oppose
				set_congress_stance_effect = {
					COUNTRY = this
					STANCE = 3
				}
			}
			if = {
				# If you're the initiator and NOT supporting
				limit = {
					global_var:imperia_vienna_congress_session_initiator = this
					NOT = {
						is_target_in_global_variable_list = {
							name = current_congress_members_on_stance_1
							target = this
						}
					}
				}
				# Set to stance 1: Supporters
				set_congress_stance_effect = {
					COUNTRY = this
					STANCE = 1
				}
			}
			if = {
				# If you're not a target or the initiator
				limit = {
					is_congress_target = no
					global_var:imperia_vienna_congress_session_initiator != this
				}
				# Weights have been divided into 3 pieces
				# --- : -35
				# -35 : 35
				# 35 : ---
				# Dead zones are between +/-45 and +/-25, they will stay on their chosen stance, prevents flip-flopping
				if = {
					# If the voting weight is at or above 45 (and you're not supporting)
					limit = {
						imperia_congress_ai_voting_weight >= 45
						NOT = {
							is_target_in_global_variable_list = {
								name = current_congress_members_on_stance_1
								target = this
							}
						}
					}
					# Set to stance 1: Supporters
					set_congress_stance_effect = {
						COUNTRY = this
						STANCE = 1
					}
				}
				else_if = {
					# Else if the voting weight is at or below -45 (and you're not opposing)
					limit = {
						imperia_congress_ai_voting_weight <= -45
						NOT = {
							is_target_in_global_variable_list = {
								name = current_congress_members_on_stance_3
								target = this
							}
						}
					}
					# Set to stance 3 : Opposers
					set_congress_stance_effect = {
						COUNTRY = this
						STANCE = 3
					}
				}
				else_if = {
					# Else if the voting weight is in the middle (and you're not abstaining)
					limit = {
						OR = {
							AND = {
								is_target_in_global_variable_list = {
									name = current_congress_members_on_stance_1
									target = this
								}
								imperia_congress_ai_voting_weight <= 25
							}
							AND = {
								imperia_congress_ai_voting_weight <= 25
								imperia_congress_ai_voting_weight >= -25
							}
							AND = {
								is_target_in_global_variable_list = {
									name = current_congress_members_on_stance_3
									target = this
								}
								imperia_congress_ai_voting_weight >= -25
							}
						}
						NOT = {
							is_target_in_global_variable_list = {
								name = current_congress_members_on_stance_2
								target = this
							}
						}
					}
					# Set to stance 2: Abstainers
					set_congress_stance_effect = {
						COUNTRY = this
						STANCE = 2
					}
				}
			}
			if = {
				# If you're the initiator, and you can end...
				# (And you're of course still a voting AI)
				limit = {
					global_var:imperia_vienna_congress_session_initiator = this
					NOT = {
						has_global_variable = imperia_vienna_congress_minimum_time
					}
					has_global_variable = imperia_vienna_congress_in_session
				}
				# Have a 20% chance of ending it
				random = {
					chance = 20
					end_congress_scripted_effect = yes
				}
			}
			if = {
				limit = {
					has_global_variable = imperia_vienna_congress_in_session
					or = {
						not = {
							exists = global_var:imperia_vienna_congress_session_target
						}
						not = {
							exists = global_var:imperia_vienna_congress_session_initiator
						}
					}
				}
				remove_global_variable = imperia_vienna_congress_in_session
				remove_global_variable = congress_random_events_enabled
			}
		}
	}
}
